<!-- index.html: Offline Web-App Starter (PDF + Signatur) -->
<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="manifest" href="manifest.json" />
    <!-- <meta name="theme-color" content="#0078D7" /> -->
    <meta name="theme-color" content="#1d3946" />
    <title>Vorabgespräch PDF Tool</title>
    <!-- Link to external CSS -->
    <link rel="stylesheet" href="style.css" />
</head>

<body>
    <main class="content">
        <header class="hero">
            <div class="hero-content">
                <img src="icons/icon-512.png" alt="Logo" class="logo" />
                <h1>Vorabgespräch</h1>
            </div>
        </header>

        <!-- Loading Indicator -->
        <div id="loading-overlay">
  <div class="spinner"></div>
</div>

        <!-- <h1>Vorabgespräch</h1> -->
        <form id="data-form">
            <div class="form-sections">
                <div class="personal-info">
                    <!-- Gender -->
                    <div>
                        <label>Geschlecht:</label><br>
                        <div class="gender-options">
                            <input type="radio" id="gender_male" name="gender" value="Mann">
                            <label for="gender_male">Mann</label><br>
                            <input type="radio" id="gender_female" name="gender" value="Frau">
                            <label for="gender_female">Frau</label>
                        </div>
                    </div>

                    <!-- Basic Inputs -->
                    <input type="text" id="first_name" placeholder="Vorname" required />
                    <input type="text" id="last_name" placeholder="Nachname" required />
                    <input type="text" id="birthdate" placeholder="Geburtsdatum" required />
                    <input type="text" id="insurance_number" placeholder="Versicherungsnummer" required />

                    <!-- Insurance Dropdown -->
                    <select id="insurance_provider" required>
                        <option value="">Versicherung auswählen</option>
                        <option value="AOK">AOK</option>
                        <option value="Barmer">Barmer</option>
                        <option value="BKK">BKK</option>
                        <option value="DAK">DAK</option>
                        <option value="IKK">IKK</option>
                        <option value="KKH">KKH</option>
                        <option value="Knappschaft">Knappschaft</option>
                        <option value="TK">TK (Techniker Krankenkasse)</option>
                        <option value="Andere">Andere</option>
                    </select>

                    <!-- Hidden by default -->
                    <input type="text" id="insurance_provider_other" placeholder="Bitte Versicherung angeben"
                        style="display: none; margin-top: 0.5rem;" />

                    <!-- <input type="text" id="product" placeholder="Baumaßnahme" /> -->
                    <input type="text" id="phone" placeholder="Telefonnummer" required/>
                    <input type="text" id="email" placeholder="E-Mail" />
                    <input type="text" id="street" placeholder="Straße" required/>
                    <input type="text" id="zip" placeholder="PLZ" required/>
                    <input type="text" id="city" placeholder="Ort" required/>
                    <input type="text" id="reference" placeholder="Empfohlen von" />


                    <select id="care_level" required>
                        <option value="">Pflegegrad auswählen</option>
                        <option value="level_1">Pflegegrad 1</option>
                        <option value="level_2">Pflegegrad 2</option>
                        <option value="level_3">Pflegegrad 3</option>
                        <option value="level_4">Pflegegrad 4</option>
                        <option value="level_5">Pflegegrad 5</option>
                    </select>

                    <label><input type="checkbox" id="aid_fund" name="aid_fund" /> Beihilfekasse?</label>

                    <!-- Elevator Field -->
                    <label>Etage</label>
                    <select id="floor">
                        <option value="">Etage auswählen</option>
                        <script>
                            const floorSelect = document.getElementById("floor");
                            for (let i = 0; i <= 30; i++) {
                                const option = document.createElement("option");
                                option.value = i;
                                option.textContent = i === 0 ? "Erdgeschoss" : `${i}. Etage`;
                                floorSelect.appendChild(option);
                            }
                        </script>
                        <!-- Add more options as needed -->
                    </select>

                    <label><input type="checkbox" id="elevator" name="elevator" /> Fahrstuhl vorhanden?</label>

                    <!-- Diagnosis -->
                    <label>Diagnose:</label>
                    <div class="diagnosis-options" id="diagnosis">
                        <label><input type="checkbox" id="bed" /> Nur im Bett</label>
                        <label><input type="checkbox" id="walk" /> Gangunsicherheit</label>
                        <label><input type="checkbox" id="walker" /> Rollator</label>
                        <label><input type="checkbox" id="wheelchair" /> Rollstuhl </label>
                        <div>
                            <label><input type="checkbox" id="always" /> Immer?</label>
                        </div>
                    </div>
                    <input type="text" id="other_diagnosis" placeholder="Weitere Diagnosen" />




                    <!-- Care Taker Toggle -->
                    <div>
                        <input type="checkbox" id="toggle_care_taker" />
                        <label for="toggle_care_taker">Betreuer hinzufügen</label>
                    </div>
                    <div class="care_taker-info" style="display: none;">
                        <input type="text" id="care_taker_first_name" placeholder="Vorname" />
                        <input type="text" id="care_taker_last_name" placeholder="Nachname" />
                        <input type="text" id="care_taker_street" placeholder="Straße" />
                        <input type="text" id="care_taker_zip_city" placeholder="PLZ und Ort" />
                        <input type="text" id="care_taker_phone" placeholder="Telefonnummer" />
                        <input type="email" id="care_taker_email" placeholder="E-Mail" />
                        <input type="text" id="care_taker_fax" placeholder="Fax" />
                    </div>

                    <!-- Landlord Toggle -->
                    <div>
                        <input type="checkbox" id="toggle_landlord" />
                        <label for="toggle_landlord">Vermieter hinzufügen</label>
                    </div>
                    <div class="landlord-info" style="display: none;">
                        <input type="text" id="landlord_full_name" placeholder="Vollständiger Name" />
                        <input type="text" id="landlord_street" placeholder="Straße" />
                        <input type="text" id="landlord_zip_city" placeholder="PLZ und Ort" />
                        <input type="text" id="landlord_phone" placeholder="Telefonnummer" />
                        <input type="text" id="landlord_fax" placeholder="Fax" />
                    </div>
                </div>

                <div class="products" id="product-options">
                    <fieldset>
                        <legend><strong>Gewünschte Leistung:</strong></legend>

                        <!-- Haltegriffe / Geländer -->
                        <label><input type="checkbox" name="grab_bars" /> Haltegriffe / Haltestangen: </label>
                        <input type="number" name="grab_bars_count" min="0" placeholder="Stück" style="width: 60px;" />
                        <br />
                        <label><input type="checkbox" name="railings" /> Geländer: </label>
                        <input type="number" name="railings_count" min="0" placeholder="Stück" style="width: 60px;" />
                        <br /><br />

                        <!-- Erhöhtes WC -->
                        <label><input type="checkbox" name="raised_toilet" />Erhöhtes WC:</label>
                        <label><input type="radio" name="raised_toilet_type" value="stand" /> Stand</label>
                        <label><input type="radio" name="raised_toilet_type" value="wall" /> Wand</label>
                        <br />

                        <!-- Eckventil -->
                        <label><input type="checkbox" name="angle_valve" />Eckventil:</label>
                        <label><input type="radio" name="angle_valve_type" value="inside" /> innen</label>
                        <label><input type="radio" name="angle_valve_type" value="outside" /> außen</label>
                        <br />

                        <!-- Dusch-WC -->
                        <label><input type="checkbox" name="shower_toilet" />Dusch-WC</label>
                        <br />

                        <!-- Türschwellen / Rampen -->
                        <label><input type="checkbox" name="threshold_removal" /> Türschwellen entfernen:</label>
                        <input type="number" name="threshold_removal_count" min="0" placeholder="Stück"
                            style="width: 60px;" />
                        <br />
                        <label><input type="checkbox" name="ramps" /> Rampen:</label>
                        <input type="number" name="ramps_count" min="0" placeholder="Stück" style="width: 60px;" />
                        <br />
                        <label><input type="checkbox" name="door_widening" /> Türverbreiterung:</label>
                        <input type="number" name="door_widening_count" min="0" placeholder="Stück"
                            style="width: 60px;" />
                        <br />
                        <label><input type="checkbox" name="sliding_door" /> Schiebetür:</label>
                        <input type="number" name="sliding_door_count" min="0" placeholder="Stück"
                            style="width: 60px;" />
                        <br />
                        <label><input type="checkbox" name="bathroom_door_slant" /> Badtür Schräge</label>
                        <br /><br />

                        <!-- Waschbereich -->
                        <label><input type="checkbox" name="wheelchair_sink" /> unterfahrbarer Waschtisch</label><br />
                        <label><input type="checkbox" name="sink_faucet" /> Waschtischarmatur</label><br /><br />

                        <!-- Dusche & Bad -->
                        <label><input type="checkbox" name="bathtub_to_shower" /> Badewanne zur Dusche</label><br />
                        <label><input type="checkbox" name="shower_to_shower" /> Dusche zur Dusche</label><br />
                        <label><input type="checkbox" name="floor_drain" /> Fußbodenentwässerung vorhanden</label><br />
                        <label><input type="checkbox" name="side_drain" /> Seitenentwässerung vorhanden</label><br />
                        <label><input type="checkbox" name="platform_requested" /> Podest gewünscht</label><br />
                        <label><input type="checkbox" name="pumping_system" /> Pumpensystem <em>(als Extraleistung
                                gewünscht)</em></label><br />
                        <label><input type="checkbox" name="bathtub_with_entry" /> Badewanne mit Einstieg</label><br />
                        <label><input type="checkbox" name="shower_curtain" /> Duschvorhang</label><br />
                        <label><input type="checkbox" name="glass_partition" /> Glasabtrennung <em>(als Extraleistung
                                gewünscht)</em></label><br />
                        <label><input type="checkbox" name="non_slip_floor" /> rutschhemmender <strong>Fußboden</strong>
                            gewünscht</label><br />

                        <!-- Bodenbelag -->
                        <label><input type="checkbox" name="floor_complete" /> komplett <em>(als
                                Extraleistung)</em></label><br />
                        <label><input type="checkbox" name="floor_shower_only" /> nur Duschbereich</label><br />
                        <label><input type="checkbox" name="floor_pvc" /> PVC - Vinyl FB</label><br /><br />

                        <!-- Wandfliesen -->
                        <strong>Wandfliesen:</strong><br />
                        <label><input type="checkbox" name="tiles_complete" /> Komplett <em>(als
                                Extraleistung)</em></label><br />
                        <label><input type="checkbox" name="tiles_bath_area" /> nur ausgebauter
                            Wannenbereich</label><br />
                        <label><input type="checkbox" name="tiles_faucet" /> Duscharmatur oder Brause <em>(als
                                Extraleistung)</em></label>
                        <br />
                        <br />
                        <!-- Sonstiges -->
                        <strong>Extra:</strong><br />
                        <label><input type="checkbox" name="other_products" /> Sonstige Leistungen:</label>
                        <input type="text" name="other_products_details" placeholder="Bitte angeben"
                            style="width: 90%;" />
                        <br />
                        <!-- <br /> -->
                        <!-- Kosten -->
                        <!-- <strong>Kosten:</strong><br />
                        <input type="text" name="costs" placeholder="Bitte angeben" style="width: 90%;" /> -->
                        <!-- <br /> -->
                    </fieldset>
                </div>
            </div>
            
            <div class="date-picker-container">
                <label for="signing-date">Datum der Unterschrift</label>
                <input type="date" id="signing-date" name="signing-date" required>
            </div>

            <button id="submit-pdf" type="submit">PDF generieren</button>
            <div class="form-buttons-container">
                <button class="reset-buttons" id="reset-pdf" type="reset">Formular zurücksetzen</button>
                <button id="open-pdf" disabled>PDF öffnen</button>
            </div>
            
        </form>

        <h2>Unterschrift</h2>
        <div class="signature-container">
            <p id="signature-disclaimer">
                Hiermit bestätige ich, dass ich die Anlagen 1 bis 8 gelesen habe und mit deren Inhalt einverstanden bin.
            </p>
            <canvas id="signature-pad" width="500" height="150" style="border:1px solid #ccc"></canvas>
            <div class="signature-buttons">
                <button class="reset-buttons" id="clear-signature">Unterschrift löschen</button>
                <button id="save-pdf" disabled>PDF speichern</button>
            </div>
        </div>

        <!-- pdf-lib -->
        <script src="libs/pdf-lib.min.js"></script>
        <!-- signature_pad -->
        <script src="libs/signature_pad.min.js"></script>
        <!-- FileSaver -->
        <script src="libs/FileSaver.min.js"></script>
        <!-- jszip -->
        <script src="libs/jszip.min.js"></script>

        <!-- Custom JavaScript -->
        <!-- <script src="main.js"></script> -->
        <script type="module" src="main.js"></script>


        <!-- Service Worker -->
        <script>
            console.log('JavaScript geladen');
            if ('serviceWorker' in navigator) {
                console.log('Service Worker wird registriert...');
                navigator.serviceWorker.register('/service-worker.js')
                    .then(() => console.log('✅ Service Worker registriert'))
                    .catch(err => console.error('Service Worker Fehler:', err));
            }
        </script>
    </main>

</body>

</html>